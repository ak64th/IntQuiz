{% extends "layout.html" %}

{% block content %}
<section class="content-header">
  <h1>帐号管理</h1>
</section>
<section class="content">
  <div class="row">
    <div class="table-container col-xs-12">
      <table class="table table-bordered table-hover table-striped">
        <thead>
        <tr>
          <td>id</td>
          <td>用户名</td>
          <td>操作</td>
        </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}

{% block script %}
{{ super() }}
<script type="application/template" id="user-row-tpl">
  <td><%= id %></td>
  <td><%= username %></td>
  <td><a type="button" class="btn btn-default btn-xs">修改密码</a></td>
</script>

<script>
  var Users = app.Collection.extend({
    url: '/api/v1/user'
  });

  var UserView = Backbone.View.extend({
    tagName: 'tr',
    template: _.template($('#user-row-tpl').html()),
    render: function(){
      this.$el.html(this.template(
        this.model.toJSON()
      ));
      return this;
    }
  });

  var UsersView = Backbone.View.extend({
    initialize: function(){
      this.listenTo(this.collection, 'add', this.addRow);
    },
    addRow: function(model){
      var view = new UserView({model: model});
      this.$('table tbody').append(view.render().$el);
    }
  });

  $(function() {
    var users = new Users;
    var usersView = new UsersView({el: $('.table-container'), collection: users});
    users.fetch()
     .done(app.alert('载入完成', 'success'));
  });
</script>
{% endblock %}